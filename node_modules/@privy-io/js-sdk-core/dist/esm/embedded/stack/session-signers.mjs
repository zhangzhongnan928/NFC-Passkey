import{getRootWalletForDelegation as e}from"../../action/delegatedActions/utils.mjs";import{getWallet as t}from"../../wallet-api/get-wallet.mjs";import{isUnifiedWallet as i}from"../../wallet-api/unified-wallet.mjs";import{updateWallet as r}from"../../wallet-api/update-wallet.mjs";import"../../utils/getAllUserEmbeddedEthereumWallets.mjs";import"../../utils/getAllUserEmbeddedSolanaWallets.mjs";import"../../utils/getUserEmbeddedEthereumWallet.mjs";import"../../utils/getUserEmbeddedSolanaWallet.mjs";import"@privy-io/public-api";import"canonicalize";async function a({client:a,wallet:l,signers:o}){if("bitcoin-segwit"===l.chain_type||"bitcoin-taproot"===l.chain_type)throw Error("Bitcoin wallets do not support session signers");if(i(l)){if(0===o.length)throw Error("Must specify at least one signer to add.");let e={wallet_id:l.id},i=await t(a,e);await r(a,e,d(a),{additional_signers:i.additional_signers.concat(o)})}else{if(l.delegated)return s(a);if(o.length>0)throw Error("This embedded wallet does not support specifying signers. If signing is enabled in the dashboard, signer will default to that key. Otherwise, no signatures will be required for the wallet.");let{user:t}=await a.user.get(),i=e(l,t);if(!i)throw Error("Unable to determine root address for delegated address.");await a.embeddedWallet.delegateWallets({rootWallet:{address:i.address,chainType:i.chain_type,imported:i.imported},delegatedWallets:[{address:l.address,chainType:l.chain_type,walletIndex:l.wallet_index}]})}return s(a)}async function l({client:e,wallet:t}){if(i(t)){let i={wallet_id:t.id};await r(e,i,d(e),{additional_signers:[]})}else await e.delegated.revoke();return s(e)}async function s(e){let{user:t}=await e.user.get();if(!t)throw Error("Could not refresh user");return{user:t}}function d(e){return(...t)=>e.embeddedWallet.signWithUserSigner(...t)}export{a as addSessionSigners,l as removeSessionSigners};
